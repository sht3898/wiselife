<template>
  <v-container class="my-5">
    <v-flex class="ma-auto" lg9 xs11>
      <h3 class="mt-5">'{{keyword}}'에 대한 검색 결과입니다. 선택된 카테고리는 '{{category}}'</h3>
      <v-row class="pa-0">
        <v-col>
          <v-row class="filtering">
            <v-col v-for="category in categories" :key="category.key">
              <v-btn
                :class="{bold: category.clicked}"
                @click="clickCategory(category)"
                x-small
                text
                style="text-align:center; font-size:10pt"
              >{{category.name}}</v-btn>
            </v-col>
          </v-row>
        </v-col>
        <v-col class="pl-5" cols="1">
          <span style="font-size:9pt; color:dimgrey">내 지역</span>
          <span class="ma-auto" style="float:center; text-align:center">
            <v-switch class="my-0 py-0" dense v-model="myarea" inset color="success"></v-switch>
          </span>
        </v-col>
      </v-row>
      <span class="ma-0 pa-0" v-for="sorting in sortingFilter" :key="sorting.key">
        <v-chip
          :color="`yellow lighten-4`"
          :class="{bold: sorting.clicked}"
          @click="clickSorting(sorting)"
          class="black--text mr-2"
          label
          small
        >{{sorting.name}}</v-chip>
      </span>
    </v-flex>
    <v-flex class="ma-auto" lg10 xs12>
      <contents-list :contentslist="this.contentslist" />
    </v-flex>
    <div class="text-center">
      <v-pagination v-model="page" :length="pagelength" circle color="success"></v-pagination>
    </div>
  </v-container>
</template>
<script>
import http from "../http-common";
import ContentsList from "@/components/contents/ContentsList";
export default {
  name: "ResultPage",
  components: {
    ContentsList
  },
  data() {
    return {
      page: 1,
      pagelength: 1,
      contentslist: [],
      categories: [
        {
          key: 0,
          name: "전체",
          clicked: false
        },
        {
          key: 1,
          name: "레저/스포츠",
          clicked: false
        },
        {
          key: 2,
          name: "요리",
          clicked: false
        },
        {
          key: 3,
          name: "수공예/공방",
          clicked: false
        },
        {
          key: 4,
          name: "놀이/게임",
          clicked: false
        },
        {
          key: 5,
          name: "문화",
          clicked: false
        },
        {
          key: 6,
          name: "예술",
          clicked: false
        },
        {
          key: 7,
          name: "축제/행사",
          clicked: false
        },
        {
          key: 8,
          name: "기타",
          clicked: false
        }
      ],
      selctedCategory: 0,
      myarea: 0,
      sortingFilter: [
        {
          key: 1,
          name: "최신순",
          clicked: false
        },
        {
          key: 2,
          name: "가나다순",
          clicked: false
        },
        {
          key: 3,
          name: "조회수순",
          clicked: false
        },
        {
          key: 4,
          name: "좋아요순",
          clicked: false
        },
        {
          key: 5,
          name: "평점순",
          clicked: false
        }
      ]
    };
  },
  methods: {
    search() {
      let config = {
        headers: { access_token: sessionStorage.getItem("token") }
      };
      // console.log(this.$route.params.category);
      // console.log(this.$route.params.keyword);

      if (this.$route.params.keyword == undefined) {
        http
          .get(`search/${this.$route.params.category}`, config)
          .then(response => {
            console.log(response);
            this.contentslist = response.data;
            console.log(this.contentslist);
            this.pagelength = Math.floor(this.contentslist.length / 12) + 1;
            console.log(this.pagelength);
          })
          .catch(err => {
            console.log(err);
          });
      } else {
        http
          .get(
            `search/${this.$route.params.category}?keyword=` +
              this.$route.params.keyword,
            config
          )
          .then(response => {
            console.log(response);
            this.contentslist = response.data;
            console.log(this.contentslist);
            this.pagelength = Math.floor(this.contentslist.length / 12) + 1;
            console.log(this.pagelength);
          })
          .catch(err => {
            console.log(err);
          });
      }
    },
    clickCategory(category) {
      for (var i = 0; i < this.categories.length; i++) {
        if (this.categories[i] != category) {
          this.categories[i].clicked = false;
        }
      }
      category.clicked = true;
      this.$router.push(
        "/result/" + category.key + "/" + this.$route.params.keyword
      );
      this.search();
    },
    clickSorting(sorting) {
      for (var i = 0; i < this.sortingFilter.length; i++) {
        if (this.sortingFilter[i] != sorting) {
          this.sortingFilter[i].clicked = false;
        }
      }
      sorting.clicked = true;
    },
    checkURL() {
      for (var i = 0; i < this.categories.length; i++) {
        if (this.categories[i].key == this.$route.params.category) {
          this.categories[i].clicked = true;
        }
      }
    }
  },
  mounted() {
    this.checkURL();
    this.search();
  },
  computed: {
    keyword: function() {
      return this.$route.params.keyword;
      this.search();
    },
    category: function() {
      for (var i = 0; i < this.categories.length; i++) {
        if (this.categories[i].key == this.$route.params.category) {
          this.categories[i].clicked = true;
        } else {
          this.categories[i].clicked = false;
        }
      }
      return this.$route.params.category;
      this.search();
    }
  }
};
</script>
<style scoped>
.filtering {
  background-color: lightgray;
  border-radius: 12px;
}
.bold {
  font-weight: bold;
  color: darkgreen;
}
</style>
